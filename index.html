<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Store Location Finder App for Delivery Personnel - Search stores and navigate with Google Maps">
    <meta name="keywords" content="delivery, gps, store locator, maps, navigation, logistics">
    <meta name="author" content="Store Location Finder">
    <meta name="theme-color" content="#667eea">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-app.vercel.app/">
    <meta property="og:title" content="Store Location Finder - Delivery App">
    <meta property="og:description" content="Find and navigate to store locations instantly. Admin uploads stores, delivery boys navigate with Google Maps.">
    <meta property="og:image" content="https://your-app.vercel.app/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://your-app.vercel.app/">
    <meta property="twitter:title" content="Store Location Finder - Delivery App">
    <meta property="twitter:description" content="Find and navigate to store locations instantly.">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://your-app.vercel.app/">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìç</text></svg>">
    
    <title>Store Location Finder - Delivery App</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .store-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .autocomplete-item:hover, .autocomplete-item.active {
            background-color: #f3f4f6;
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* RTL support for Marathi */
        [dir="rtl"] {
            direction: rtl;
        }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="rtl"] .mr-1 { margin-right: 0; margin-left: 0.25rem; }
        [dir="rtl"] .mr-3 { margin-right: 0; margin-left: 0.75rem; }
        [dir="rtl"] .mr-4 { margin-right: 0; margin-left: 1rem; }
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .text-right { text-align: left; }
        [dir="rtl"] .text-left { text-align: right; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <!-- Language Toggle -->
        <div class="fixed top-4 right-4 z-50">
            <button onclick="toggleLanguage()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all flex items-center gap-2">
                <i class="fas fa-globe"></i>
                <span id="langToggleText">‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
            </button>
        </div>
        
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md slide-up">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-map-marker-alt text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800" data-i18n="appTitle">Store Locator</h1>
                <p class="text-gray-500 mt-2" data-i18n="appSubtitle">Delivery Boy GPS App</p>
            </div>
            
            <div class="space-y-4">
                <!-- Delivery Login Section (Default) -->
                <div id="deliveryLoginSection">
                    <div class="text-center py-6">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-truck text-green-600 text-2xl"></i>
                        </div>
                        <p class="text-gray-600 mb-4" data-i18n="deliveryDesc">Search & Navigate to Stores</p>
                        <button onclick="login('delivery')" class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-semibold transition-all text-lg">
                            <i class="fas fa-play mr-2"></i><span data-i18n="delivery">Delivery Boy Login</span>
                        </button>
                    </div>
                </div>
                
                <!-- Admin Login Section (Hidden by default) -->
                <div id="adminLoginSection" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">
                        <i class="fas fa-lock text-purple-600 mr-2"></i><span data-i18n="admin">Admin Access</span>
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="username">Username</label>
                        <input type="text" id="username" data-i18n-placeholder="enterUsername" placeholder="Enter username" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="password">Password</label>
                        <div class="relative">
                            <input type="password" id="password" data-i18n-placeholder="enterPassword" placeholder="Enter password" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none pr-12">
                            <button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-eye" id="passwordToggleIcon"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="submitLogin()" class="flex-1 bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-all">
                            <span data-i18n="loginBtn">Login</span>
                        </button>
                        <button onclick="goToDelivery()" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg transition-all">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <p class="text-center text-gray-400 text-sm mt-6" id="demoHint">
                <i class="fas fa-info-circle mr-1"></i> <span data-i18n="demoHint">Delivery Boy App - Click to Start</span>
            </p>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen">
        <!-- Admin Header -->
        <header class="gradient-bg text-white p-4 sticky top-0 z-50">
            <div class="max-w-6xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-store text-2xl"></i>
                    <h1 class="text-xl font-bold" data-i18n="adminDashboard">Admin Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Language Toggle -->
                    <button onclick="toggleLanguage()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-all flex items-center gap-2">
                        <i class="fas fa-globe"></i>
                        <span id="adminLangToggle">‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
                    </button>
                    <!-- Data Visibility Toggle -->
                    <button id="dataVisibilityToggle" onclick="toggleDataVisibility()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all flex items-center gap-2">
                        <i class="fas fa-eye" id="visibilityIcon"></i>
                        <span id="visibilityText" data-i18n="showData">Show Data</span>
                    </button>
                    <span class="text-sm bg-white/20 px-3 py-1 rounded-full">
                        <i class="fas fa-database mr-1"></i>
                        <span id="storeCount">0</span> <span data-i18n="stores">Stores</span>
                    </span>
                    <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-sign-out-alt mr-2"></i><span data-i18n="logout">Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-6xl mx-auto p-4 space-y-6">
            <!-- Data Visibility Status -->
            <div id="visibilityStatusCard" class="bg-white rounded-2xl card-shadow p-6 slide-up">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div id="visibilityStatusIcon" class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-eye text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800" id="visibilityStatusTitle" data-i18n="dataVisible">Data is Visible to Delivery Boys</h3>
                            <p class="text-gray-500 text-sm" id="visibilityStatusDesc" data-i18n="dataVisibleDesc">Delivery boys can search and navigate to all stores</p>
                        </div>
                    </div>
                    <button onclick="toggleDataVisibility()" class="px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2" id="visibilityActionButton">
                        <i class="fas fa-eye-slash" id="actionIcon"></i>
                        <span data-i18n="hideData">Hide Data</span>
                    </button>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="bg-white rounded-2xl card-shadow p-6 slide-up">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-upload text-purple-600 mr-2"></i><span data-i18n="uploadCsv">Upload Stores CSV</span>
                        </h2>
                        <p class="text-gray-500 text-sm mt-1" data-i18n="uploadDesc">Import store locations from spreadsheet</p>
                    </div>
                </div>

                <!-- File Upload Area -->
                <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-500 transition-all cursor-pointer">
                    <input type="file" id="csvFile" accept=".csv" class="hidden" onchange="handleFileSelect(event)">
                    <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 font-medium" data-i18n="dropZone">Drop CSV file here or click to browse</p>
                    <p class="text-gray-400 text-sm mt-2" data-i18n="supportsCsv">Supports .csv format</p>
                    <button onclick="document.getElementById('csvFile').click()" class="mt-4 bg-purple-100 text-purple-700 px-6 py-2 rounded-lg hover:bg-purple-200 transition-all">
                        <span data-i18n="selectFile">Select File</span>
                    </button>
                </div>

                <!-- CSV Format Guide -->
                <div class="mt-6 bg-gray-50 rounded-xl p-4">
                    <h3 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-info-circle text-blue-500 mr-2"></i><span data-i18n="csvFormat">CSV Format</span>
                    </h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-2" data-i18n="requiredHeaders">Required Headers:</p>
                            <code class="text-sm bg-gray-200 px-2 py-1 rounded">shop</code>
                            <code class="text-sm bg-gray-200 px-2 py-1 rounded">latitude</code>
                            <code class="text-sm bg-gray-200 px-2 py-1 rounded">longitude</code>
                            <code class="text-sm bg-gray-200 px-2 py-1 rounded">salesman</code>
                            <code class="text-sm bg-gray-200 px-2 py-1 rounded">beat</code>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <p class="text-xs text-gray-500 mb-2" data-i18n="sampleData">Sample Data:</p>
                            <pre class="text-xs bg-gray-200 p-2 rounded overflow-x-auto">shop,latitude,longitude,salesman,beat
ABC Store,28.6139,77.2090,John,North Zone
XYZ Mart,28.6128,77.2294,Mike,South Zone</pre>
                        </div>
                    </div>
                    <button onclick="loadSampleData()" class="mt-4 text-purple-600 hover:text-purple-800 text-sm font-medium">
                        <i class="fas fa-magic mr-1"></i><span data-i18n="loadSample">Load Sample Data</span>
                    </button>
                </div>

                <!-- Upload Summary -->
                <div id="uploadSummary" class="hidden mt-6 bg-green-50 border border-green-200 rounded-xl p-4">
                    <div class="flex items-center text-green-700 mb-3">
                        <i class="fas fa-check-circle text-2xl mr-3"></i>
                        <h3 class="font-bold text-lg" data-i18n="uploadComplete">Upload Complete!</h3>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-white rounded-lg p-3">
                            <p class="text-2xl font-bold text-gray-800" id="totalRows">0</p>
                            <p class="text-xs text-gray-500" data-i18n="totalRows">Total Rows</p>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <p class="text-2xl font-bold text-green-600" id="insertedRows">0</p>
                            <p class="text-xs text-gray-500" data-i18n="inserted">Inserted</p>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <p class="text-2xl font-bold text-orange-500" id="skippedRows">0</p>
                            <p class="text-xs text-gray-500" data-i18n="skipped">Skipped (Duplicates)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stores List Section -->
            <div class="bg-white rounded-2xl card-shadow p-6 slide-up">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-list text-purple-600 mr-2"></i><span data-i18n="allStores">All Stores</span>
                        </h2>
                        <p class="text-gray-500 text-sm mt-1" data-i18n="manageStores">Manage store locations</p>
                    </div>
                    <div class="flex gap-3">
                        <select id="filterBeat" onchange="filterStores()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="" data-i18n="allBeats">All Beats</option>
                        </select>
                        <select id="filterSalesman" onchange="filterStores()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                            <option value="" data-i18n="allSalesmen">All Salesmen</option>
                        </select>
                        <button onclick="clearAllStores()" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-all">
                            <i class="fas fa-trash mr-2"></i><span data-i18n="clearAll">Clear All</span>
                        </button>
                    </div>
                </div>

                <!-- Stores Table -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase" data-i18n="shop">Shop</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase" data-i18n="coordinates">Coordinates</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase" data-i18n="salesman">Salesman</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase" data-i18n="beat">Beat</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase" data-i18n="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="storesTableBody" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-2"></i>
                                    <p data-i18n="noStores">No stores uploaded yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="hidden mt-4 flex items-center justify-between">
                    <p class="text-sm text-gray-500"><span data-i18n="showing">Showing</span> <span id="showingCount">0</span> stores</p>
                    <div class="flex gap-2">
                        <button onclick="changePage(-1)" class="px-3 py-1 border rounded-lg hover:bg-gray-50" data-i18n="previous">Previous</button>
                        <span id="pageInfo" class="px-3 py-1"><span data-i18n="page">Page</span> 1</span>
                        <button onclick="changePage(1)" class="px-3 py-1 border rounded-lg hover:bg-gray-50" data-i18n="next">Next</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Delivery Boy Dashboard -->
    <div id="deliveryDashboard" class="hidden min-h-screen">
        <!-- Delivery Header -->
        <header class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 sticky top-0 z-50">
            <div class="max-w-6xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-truck text-2xl"></i>
                    <h1 class="text-xl font-bold" data-i18n="deliveryDashboard">Delivery Navigator</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Language Toggle -->
                    <button onclick="toggleLanguage()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-all flex items-center gap-2">
                        <i class="fas fa-globe"></i>
                        <span id="deliveryLangToggle">‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
                    </button>
                    <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-sign-out-alt mr-2"></i><span data-i18n="logout">Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-6xl mx-auto p-4 space-y-6">
            <!-- Search Section -->
            <div class="bg-white rounded-2xl card-shadow p-6 slide-up">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-search text-green-600 mr-2"></i><span data-i18n="findStore">Find Store</span>
                </h2>

                <!-- Search Box with Autocomplete -->
                <div class="relative">
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Search store by name..." 
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none text-lg"
                                oninput="handleSearch(event)" onfocus="showRecentSearches()">
                        </div>
                        <button onclick="performSearch()" class="bg-green-500 hover:bg-green-600 text-white px-6 rounded-xl transition-all">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <!-- Autocomplete Dropdown -->
                    <div id="autocompleteDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-80 overflow-y-auto">
                    </div>

                    <!-- Recent Searches -->
                    <div id="recentSearches" class="hidden mt-3">
                        <p class="text-xs text-gray-500 mb-2"><span data-i18n="recentSearches">Recent Searches:</span></p>
                        <div id="recentSearchTags" class="flex flex-wrap gap-2">
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="mt-4 flex flex-wrap gap-3">
                    <select id="deliveryFilterBeat" onchange="filterDeliveryStores()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none">
                        <option value="" data-i18n="allBeats">All Beats</option>
                    </select>
                    <select id="deliveryFilterSalesman" onchange="filterDeliveryStores()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none">
                        <option value="" data-i18n="allSalesmen">All Salesmen</option>
                    </select>
                </div>
            </div>

            <!-- Search Results -->
            <div id="searchResultsSection" class="hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">
                        <i class="fas fa-map-pin text-red-500 mr-2"></i><span data-i18n="searchResults">Search Results</span>
                        <span id="resultCount" class="text-sm font-normal text-gray-500">(0 <span data-i18n="found">found</span>)</span>
                    </h3>
                </div>
                <div id="searchResults" class="space-y-3">
                </div>
            </div>

            <!-- All Stores Grid -->
            <div class="bg-white rounded-2xl card-shadow p-6 slide-up">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-th-large text-green-600 mr-2"></i><span data-i18n="allStores">All Stores</span>
                </h2>
                <div id="storesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-store text-4xl mb-2"></i>
                        <p data-i18n="noStoresAvailable">No stores available. Please ask admin to upload data.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Store Detail Modal -->
    <div id="storeModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto slide-up">
            <div class="gradient-bg text-white p-6 rounded-t-2xl">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 id="modalStoreName" class="text-2xl font-bold"></h3>
                        <p id="modalStoreId" class="text-white/70 text-sm"></p>
                    </div>
                    <button onclick="closeModal()" class="text-white/80 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-map-marker-alt text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500" data-i18n="coordinates">Coordinates</p>
                        <p id="modalCoords" class="font-semibold text-gray-800"></p>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-user text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500" data-i18n="salesman">Salesman</p>
                        <p id="modalSalesman" class="font-semibold text-gray-800"></p>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-route text-orange-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500" data-i18n="beat">Beat</p>
                        <p id="modalBeat" class="font-semibold text-gray-800"></p>
                    </div>
                </div>
                
                <!-- Map Preview -->
                <div class="bg-gray-100 rounded-xl h-48 flex items-center justify-center">
                    <a id="mapLink" href="#" target="_blank" class="text-center group">
                        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:scale-110 transition-transform">
                            <i class="fas fa-directions text-white text-2xl"></i>
                        </div>
                        <p class="text-green-600 font-semibold" data-i18n="openMaps">Open in Google Maps</p>
                        <p class="text-gray-500 text-sm" data-i18n="tapNavigate">Tap to navigate</p>
                    </a>
                </div>
                
                <a id="mapBtn" href="#" target="_blank" class="block w-full bg-green-500 hover:bg-green-600 text-white text-center py-4 rounded-xl font-semibold transition-all">
                    <i class="fas fa-navigation mr-2"></i><span data-i18n="startNavigation">Start Navigation</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-xl shadow-lg z-50 slide-up">
        <span id="toastMessage"></span>
    </div>

    <script>
        // ============================================
        // ROUTING & URL HANDLING
        // ============================================
        function handleRoute() {
            const path = window.location.hash.replace('#', '') || window.location.pathname;
            
            if (path === '/admin' || path.includes('admin')) {
                // Show admin login form
                document.getElementById('deliveryLoginSection').classList.add('hidden');
                document.getElementById('adminLoginSection').classList.remove('hidden');
                document.getElementById('demoHint').classList.add('hidden');
                return true;
            } else if (path === '/' || path === '' || path === 'index.html') {
                // Show delivery login (default)
                document.getElementById('deliveryLoginSection').classList.remove('hidden');
                document.getElementById('adminLoginSection').classList.add('hidden');
                document.getElementById('demoHint').classList.remove('hidden');
                return false;
            }
            return false;
        }

        function goToAdminLogin() {
            window.location.hash = '/admin';
            handleRoute();
        }

        function goToDelivery() {
            window.location.hash = '';
            handleRoute();
        }

        // ============================================
        // LANGUAGE TRANSLATIONS
        // ============================================
        const translations = {
            en: {
                // App Title
                appTitle: "Store Locator",
                appSubtitle: "Delivery Boy GPS App",
                
                // Login Screen
                admin: "Admin",
                adminDesc: "Upload & Manage",
                delivery: "Delivery",
                deliveryDesc: "Search & Navigate",
                username: "Username",
                enterUsername: "Enter username",
                password: "Password",
                enterPassword: "Enter password",
                loginBtn: "Login",
                demoHint: "Delivery Boy App - Click to Start",
                
                // Admin Dashboard
                adminDashboard: "Admin Dashboard",
                stores: "Stores",
                logout: "Logout",
                
                // Data Visibility
                showData: "Show Data",
                hideData: "Hide Data",
                dataVisible: "Data is Visible to Delivery Boys",
                dataHidden: "Data is Hidden from Delivery Boys",
                dataVisibleDesc: "Delivery boys can search and navigate to all stores",
                dataHiddenDesc: "Delivery boys cannot access store data",
                dataVisibilityToggled: "Data visibility changed",
                
                // Upload Section
                uploadCsv: "Upload Stores CSV",
                uploadDesc: "Import store locations from spreadsheet",
                dropZone: "Drop CSV file here or click to browse",
                supportsCsv: "Supports .csv format",
                selectFile: "Select File",
                csvFormat: "CSV Format",
                requiredHeaders: "Required Headers:",
                sampleData: "Sample Data:",
                loadSample: "Load Sample Data",
                
                // Upload Summary
                uploadComplete: "Upload Complete!",
                totalRows: "Total Rows",
                inserted: "Inserted",
                skipped: "Skipped (Duplicates)",
                
                // Stores List
                allStores: "All Stores",
                manageStores: "Manage store locations",
                allBeats: "All Beats",
                allSalesmen: "All Salesmen",
                clearAll: "Clear All",
                shop: "Shop",
                coordinates: "Coordinates",
                salesman: "Salesman",
                beat: "Beat",
                actions: "Actions",
                view: "View",
                delete: "Delete",
                navigate: "Navigate",
                noStores: "No stores uploaded yet",
                noStoresFound: "No stores found",
                showing: "Showing",
                page: "Page",
                previous: "Previous",
                next: "Next",
                
                // Delivery Dashboard
                deliveryDashboard: "Delivery Navigator",
                findStore: "Find Store",
                searchPlaceholder: "Search store by name...",
                recentSearches: "Recent Searches:",
                noRecentSearches: "No recent searches",
                searchResults: "Search Results",
                found: "found",
                noResultsFor: "No stores found for",
                noStoresAvailable: "No stores available. Please ask admin to upload data.",
                
                // Store Modal
                storeDetails: "Store Details",
                openMaps: "Open in Google Maps",
                tapNavigate: "Tap to navigate",
                startNavigation: "Start Navigation",
                
                // Toast Messages
                welcomeAdmin: "Welcome Admin!",
                welcomeDelivery: "Welcome Delivery Boy!",
                uploadSuccess: "Successfully imported",
                stores: "stores!",
                loadedSample: "Loaded sample stores!",
                storeDeleted: "Store deleted successfully",
                allCleared: "All stores cleared",
                openingMaps: "Opening Google Maps...",
                uploadCsvError: "Please upload a CSV file",
                csvEmpty: "CSV file is empty",
                invalidCredentials: "Invalid username or password",
                
                // Buttons
                confirmDelete: "Are you sure you want to delete this store?",
                confirmClearAll: "Are you sure you want to delete ALL stores? This cannot be undone.",
            },
            mr: {
                // App Title
                appTitle: "‡§¶‡•Å‡§ï‡§æ‡§® ‡§∂‡•ã‡§ß‡§ï",
                appSubtitle: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø GPS ‡§Ö‡•Ö‡§™",
                
                // Login Screen
                admin: "‡§Ö‡•Ö‡§°‡§Æ‡§ø‡§®",
                adminDesc: "‡§Ö‡§™‡§≤‡•ã‡§° ‡§Ü‡§£‡§ø ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®",
                delivery: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä",
                deliveryDesc: "‡§∂‡•ã‡§ß ‡§Ü‡§£‡§ø ‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§∂‡§®",
                username: "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ‡§®‡§æ‡§µ",
                enterUsername: "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ‡§®‡§æ‡§µ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ",
                password: "‡§∏‡§Ç‡§ï‡•á‡§§‡§∂‡§¨‡•ç‡§¶",
                enterPassword: "‡§∏‡§Ç‡§ï‡•á‡§§‡§∂‡§¨‡•ç‡§¶ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ",
                loginBtn: "‡§≤‡•â‡§ó‡§ø‡§®",
                demoHint: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø ‡§Ö‡•Ö‡§™ - ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ",
                
                // Admin Dashboard
                adminDashboard: "‡§Ö‡•Ö‡§°‡§Æ‡§ø‡§® ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
                stores: "‡§¶‡•Å‡§ï‡§æ‡§®‡•á",
                logout: "‡§¨‡§æ‡§π‡•á‡§∞ ‡§™‡§°‡§æ",
                
                // Data Visibility
                showData: "‡§°‡•á‡§ü‡§æ ‡§¶‡§æ‡§ñ‡§µ‡§æ",
                hideData: "‡§°‡•á‡§ü‡§æ ‡§≤‡§™‡§µ‡§æ",
                dataVisible: "‡§°‡•á‡§ü‡§æ ‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø‡§®‡§æ ‡§¶‡§ø‡§∏‡§§ ‡§Ü‡§π‡•á",
                dataHidden: "‡§°‡•á‡§ü‡§æ ‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø‡§™‡§æ‡§∏‡•Ç‡§® ‡§≤‡§™‡§µ‡§≤‡§æ ‡§Ü‡§π‡•á",
                dataVisibleDesc: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø ‡§∏‡§∞‡•ç‡§µ ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§∂‡•ã‡§ß‡•Ç ‡§Ü‡§£‡§ø ‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§§‡§æ‡§§",
                dataHiddenDesc: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø ‡§¶‡•Å‡§ï‡§æ‡§®‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§°‡•á‡§ü‡§æ‡§™‡§∞‡•ç‡§Ø‡§Ç‡§§ ‡§™‡•ã‡§π‡•ã‡§ö‡•Ç ‡§∂‡§ï‡§§ ‡§®‡§æ‡§π‡•Ä‡§§",
                dataVisibilityToggled: "‡§°‡•á‡§ü‡§æ ‡§¶‡•É‡§∂‡•ç‡§Ø‡§Æ‡§æ‡§®‡§§‡§æ ‡§¨‡§¶‡§≤‡§≤‡•Ä",
                
                // Upload Section
                uploadCsv: "‡§¶‡•Å‡§ï‡§æ‡§®‡•á CSV ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ",
                uploadDesc: "‡§∏‡•ç‡§™‡•ç‡§∞‡•á‡§°‡§∂‡•Ä‡§ü‡§Æ‡§ß‡•Ç‡§® ‡§¶‡•Å‡§ï‡§æ‡§®‡§æ‡§Ç‡§ö‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§æ",
                dropZone: "CSV ‡§´‡§æ‡§á‡§≤ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ù ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ",
                supportsCsv: ".csv ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§",
                selectFile: "‡§´‡§æ‡§á‡§≤ ‡§®‡§ø‡§µ‡§°‡§æ",
                csvFormat: "CSV ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™",
                requiredHeaders: "‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•á‡§°‡§∞‡•ç‡§∏:",
                sampleData: "‡§®‡§Æ‡•Å‡§®‡§æ ‡§°‡•á‡§ü‡§æ:",
                loadSample: "‡§®‡§Æ‡•Å‡§®‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ",
                
                // Upload Summary
                uploadComplete: "‡§Ö‡§™‡§≤‡•ã‡§° ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ù‡§æ‡§≤‡•á!",
                totalRows: "‡§è‡§ï‡•Ç‡§£ ‡§ì‡§≥‡•Ä",
                inserted: "‡§∏‡§Æ‡§æ‡§µ‡§ø‡§∑‡•ç‡§ü",
                skipped: "‡§µ‡§ó‡§≥‡§≤‡•á (‡§°‡•Å‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§ü)",
                
                // Stores List
                allStores: "‡§∏‡§∞‡•ç‡§µ ‡§¶‡•Å‡§ï‡§æ‡§®‡•á",
                manageStores: "‡§¶‡•Å‡§ï‡§æ‡§®‡§æ‡§Ç‡§ö‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡§æ",
                allBeats: "‡§∏‡§∞‡•ç‡§µ ‡§¨‡•Ä‡§ü‡•ç‡§∏",
                allSalesmen: "‡§∏‡§∞‡•ç‡§µ ‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡§®",
                clearAll: "‡§∏‡§∞‡•ç‡§µ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡§æ",
                shop: "‡§¶‡•Å‡§ï‡§æ‡§®",
                coordinates: "‡§ï‡•ã‡§ë‡§∞‡•ç‡§°‡§ø‡§®‡•á‡§ü‡•ç‡§∏",
                salesman: "‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡§®",
                beat: "‡§¨‡•Ä‡§ü",
                actions: "‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
                view: "‡§™‡§π‡§æ",
                delete: "‡§π‡§ü‡§µ‡§æ",
                navigate: "‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡§æ",
                noStores: "‡§Ö‡§ú‡•Ç‡§® ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡•á‡§≤‡•á‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä‡§§",
                noStoresFound: "‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§∏‡§æ‡§™‡§°‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä‡§§",
                showing: "‡§¶‡§æ‡§ñ‡§µ‡§§ ‡§Ü‡§π‡•á",
                page: "‡§™‡•É‡§∑‡•ç‡§†",
                previous: "‡§Æ‡§æ‡§ó‡•Ä‡§≤",
                next: "‡§™‡•Å‡§¢‡•Ä‡§≤",
                
                // Delivery Dashboard
                deliveryDashboard: "‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§ü‡§∞",
                findStore: "‡§¶‡•Å‡§ï‡§æ‡§® ‡§∂‡•ã‡§ß‡§æ",
                searchPlaceholder: "‡§¶‡•Å‡§ï‡§æ‡§®‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§®‡§æ‡§µ‡§æ‡§®‡•á ‡§∂‡•ã‡§ß‡§æ...",
                recentSearches: "‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤ ‡§∂‡•ã‡§ß:",
                noRecentSearches: "‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤ ‡§∂‡•ã‡§ß ‡§®‡§æ‡§π‡•Ä‡§§",
                searchResults: "‡§∂‡•ã‡§ß ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ",
                found: "‡§∏‡§æ‡§™‡§°‡§≤‡•á",
                noResultsFor: "‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§∏‡§æ‡§™‡§°‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä‡§§",
                noStoresAvailable: "‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä‡§§. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§°‡•á‡§ü‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ö‡•Ö‡§°‡§Æ‡§ø‡§®‡§∂‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§æ‡§ß‡§æ.",
                
                // Store Modal
                storeDetails: "‡§¶‡•Å‡§ï‡§æ‡§® ‡§§‡§™‡§∂‡•Ä‡§≤",
                openMaps: "Google Maps ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§â‡§ò‡§°‡§æ",
                tapNavigate: "‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ü‡•Ö‡§™ ‡§ï‡§∞‡§æ",
                startNavigation: "‡§®‡•á‡§µ‡•ç‡§π‡§ø‡§ó‡•á‡§∂‡§® ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
                
                // Toast Messages
                welcomeAdmin: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ö‡•Ö‡§°‡§Æ‡§ø‡§®!",
                welcomeDelivery: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§¨‡•â‡§Ø!",
                uploadSuccess: "‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡•á‡§≤‡•á",
                stores: "‡§¶‡•Å‡§ï‡§æ‡§®‡•á!",
                loadedSample: "‡§®‡§Æ‡•Å‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§≤‡•ã‡§° ‡§ï‡•á‡§≤‡•Ä!",
                storeDeleted: "‡§¶‡•Å‡§ï‡§æ‡§® ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§π‡§ü‡§µ‡§≤‡•á",
                allCleared: "‡§∏‡§∞‡•ç‡§µ ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§∏‡§æ‡§´ ‡§ï‡•á‡§≤‡•Ä",
                openingMaps: "Google Maps ‡§â‡§ò‡§°‡§§ ‡§Ü‡§π‡•á...",
                uploadCsvError: "‡§ï‡•É‡§™‡§Ø‡§æ CSV ‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ",
                csvEmpty: "CSV ‡§´‡§æ‡§á‡§≤ ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§Ü‡§π‡•á",
                invalidCredentials: "‡§Ö‡§µ‡•à‡§ß ‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ‡§®‡§æ‡§µ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§‡§∂‡§¨‡•ç‡§¶",
                
                // Buttons
                confirmDelete: "‡§Ü‡§™‡§£ ‡§ñ‡§∞‡•ã‡§ñ‡§∞ ‡§π‡•á ‡§¶‡•Å‡§ï‡§æ‡§® ‡§π‡§ü‡§µ‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ?",
                confirmClearAll: "‡§Ü‡§™‡§£ ‡§∏‡§∞‡•ç‡§µ ‡§¶‡•Å‡§ï‡§æ‡§®‡•á ‡§π‡§ü‡§µ‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ? ‡§π‡•á ‡§™‡§∞‡§§ ‡§ï‡§∞‡§§‡§æ ‡§Ø‡•á‡§£‡§æ‡§∞ ‡§®‡§æ‡§π‡•Ä.",
            }
        };

        // Current language state
        let currentLang = localStorage.getItem('appLanguage') || 'en';

        // Translation helper function
        function t(key) {
            return translations[currentLang][key] || translations['en'][key] || key;
        }

        // ============================================
        // LANGUAGE TOGGLE FUNCTION
        // ============================================
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'mr' : 'en';
            localStorage.setItem('appLanguage', currentLang);
            updateLanguageUI();
        }

        function updateLanguageUI() {
            // Update language toggle button text
            const langToggleTexts = document.querySelectorAll('#langToggleText, #adminLangToggle, #deliveryLangToggle');
            langToggleTexts.forEach(el => {
                el.textContent = currentLang === 'en' ? '‡§Æ‡§∞‡§æ‡§†‡•Ä' : 'English';
            });

            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });

            // Update filter dropdowns
            updateFilterLanguage();
        }

        function updateFilterLanguage() {
            // Store current selections
            const beatValue = document.getElementById('filterBeat')?.value || '';
            const salesmanValue = document.getElementById('filterSalesman')?.value || '';
            const deliveryBeatValue = document.getElementById('deliveryFilterBeat')?.value || '';
            const deliverySalesmanValue = document.getElementById('deliveryFilterSalesman')?.value || '';

            // Update filter options with translated text
            const filterSelects = ['filterBeat', 'filterSalesman', 'deliveryFilterBeat', 'deliveryFilterSalesman'];
            filterSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const firstOption = select.querySelector('option');
                    if (firstOption && (firstOption.value === '')) {
                        if (selectId.includes('Beat')) {
                            firstOption.textContent = t('allBeats');
                        } else if (selectId.includes('Salesman')) {
                            firstOption.textContent = t('allSalesmen');
                        }
                    }
                }
            });

            // Restore selections
            if (document.getElementById('filterBeat')) document.getElementById('filterBeat').value = beatValue;
            if (document.getElementById('filterSalesman')) document.getElementById('filterSalesman').value = salesmanValue;
            if (document.getElementById('deliveryFilterBeat')) document.getElementById('deliveryFilterBeat').value = deliveryBeatValue;
            if (document.getElementById('deliveryFilterSalesman')) document.getElementById('deliveryFilterSalesman').value = deliverySalesmanValue;
        }

        // ============================================
        // API CONFIGURATION
        // ============================================
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';

        // ============================================
        // API FUNCTIONS
        // ============================================
        const API = {
            // Get all stores with optional filters
            getStores: async (params = {}) => {
                try {
                    const queryString = new URLSearchParams(params).toString();
                    const response = await fetch(`${API_BASE}/stores${queryString ? '?' + queryString : ''}`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API Error:', error);
                    return { success: false, stores: [], dataVisible: true };
                }
            },

            // Upload CSV data
            uploadCSV: async (csvData) => {
                try {
                    const response = await fetch(`${API_BASE}/upload-csv`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ csvData })
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Upload Error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Delete store(s)
            deleteStore: async (id) => {
                try {
                    const response = await fetch(`${API_BASE}/stores?id=${id}`, {
                        method: 'DELETE'
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Delete Error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Delete all stores
            clearAllStores: async () => {
                try {
                    const response = await fetch(`${API_BASE}/stores?id=all`, {
                        method: 'DELETE'
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Clear Error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Get settings
            getSettings: async () => {
                try {
                    const response = await fetch(`${API_BASE}/settings`);
                    return await response.json();
                } catch (error) {
                    console.error('Settings Error:', error);
                    return { success: false, dataVisible: true };
                }
            },

            // Update settings
            updateSettings: async (key, value) => {
                try {
                    const response = await fetch(`${API_BASE}/settings`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ key, value })
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Update Settings Error:', error);
                    return { success: false, error: error.message };
                }
            }
        };

        // ============================================
        // LOCAL STORAGE (for user data only)
        // ============================================
        const DB = {
            getUser: () => JSON.parse(localStorage.getItem('currentUser') || 'null'),
            setUser: (user) => localStorage.setItem('currentUser', JSON.stringify(user)),
            getRecentSearches: () => JSON.parse(localStorage.getItem('recentSearches') || '[]'),
            addRecentSearch: (term) => {
                let searches = DB.getRecentSearches();
                searches = searches.filter(s => s.toLowerCase() !== term.toLowerCase());
                searches.unshift(term);
                searches = searches.slice(0, 10);
                localStorage.setItem('recentSearches', JSON.stringify(searches));
            },
            // Legacy methods for API compatibility
            getStores: async () => {
                const result = await API.getStores();
                return result.stores || [];
            },
            setStores: async (stores) => {
                // Stores are now managed via API, not localStorage
                console.log('Stores are now persisted via API');
            },
            getDataVisibility: async () => {
                const settings = await API.getSettings();
                return settings.dataVisible !== false;
            }
        };

        // ============================================
        // STATE
        // ============================================
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredStores = [];
        let selectedRole = null;

        // ============================================
        // PASSWORD VISIBILITY TOGGLE
        // ============================================
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // ============================================
        // AUTH FUNCTIONS
        // ============================================
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: 'Harshil',
            password: 'Harshil@2003'
        };

        function login(role) {
            selectedRole = role;
            
            // Delivery role can login directly without credentials
            if (role === 'delivery') {
                const user = {
                    id: Date.now(),
                    username: 'delivery_user',
                    role: 'delivery',
                    loginTime: new Date().toISOString()
                };
                DB.setUser(user);
                showToast(t('welcomeDelivery'));
                showDeliveryDashboard();
                return;
            }
        }

        function submitLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            // Validate admin credentials
            if (username !== ADMIN_CREDENTIALS.username || password !== ADMIN_CREDENTIALS.password) {
                showToast(t('invalidCredentials'), 'error');
                return;
            }
            
            const user = {
                id: Date.now(),
                username: username,
                role: 'admin',
                loginTime: new Date().toISOString()
            };
            
            DB.setUser(user);
            showToast(t('welcomeAdmin'));
            showAdminDashboard();
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.hash = '';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('deliveryDashboard').classList.add('hidden');
            handleRoute();
            selectedRole = null;
        }

        // ============================================
        // DASHBOARD FUNCTIONS
        // ============================================
        function showAdminDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadAdminData();
        }

        function showDeliveryDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('deliveryDashboard').classList.remove('hidden');
            loadDeliveryData();
        }

        // ============================================
        // CSV PARSING
        // ============================================
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                parseCSV(file);
            }
        }

        // Drag and drop
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-purple-500', 'bg-purple-50');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-purple-500', 'bg-purple-50');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-purple-500', 'bg-purple-50');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.csv')) {
                parseCSV(file);
            } else {
                showToast('Please upload a CSV file', 'error');
            }
        });

        function parseCSV(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim());
                
                if (lines.length < 2) {
                    showToast('CSV file is empty', 'error');
                    return;
                }

                const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/['"]/g, ''));
                const stores = DB.getStores();
                
                let inserted = 0;
                let skipped = 0;

                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length < 3) continue;

                    const storeData = {};
                    headers.forEach((header, index) => {
                        storeData[header] = values[index] ? values[index].trim().replace(/['"]/g, '') : '';
                    });

                    // Map headers to our schema
                    const newStore = {
                        id: Date.now() + i,
                        shop: storeData.shop || storeData.store_name || storeData.name || storeData.store || 'Unknown Shop',
                        latitude: parseFloat(storeData.latitude || storeData.lat || 0),
                        longitude: parseFloat(storeData.longitude || storeData.lng || storeData.long || 0),
                        salesman: storeData.salesman || storeData.salesman_name || 'Unassigned',
                        beat: storeData.beat || storeData.beat_name || 'Unassigned',
                        created_at: new Date().toISOString()
                    };

                    // Validate coordinates
                    if (isNaN(newStore.latitude) || isNaN(newStore.longitude)) {
                        skipped++;
                        continue;
                    }

                    // Check for duplicates
                    const isDuplicate = stores.some(s => 
                        s.shop.toLowerCase() === newStore.shop.toLowerCase() &&
                        Math.abs(s.latitude - newStore.latitude) < 0.0001 &&
                        Math.abs(s.longitude - newStore.longitude) < 0.0001
                    );

                    if (isDuplicate) {
                        skipped++;
                    } else {
                        stores.push(newStore);
                        inserted++;
                    }
                }

                DB.setStores(stores);
                
                // Show summary
                document.getElementById('uploadSummary').classList.remove('hidden');
                document.getElementById('totalRows').textContent = lines.length - 1;
                document.getElementById('insertedRows').textContent = inserted;
                document.getElementById('skippedRows').textContent = skipped;
                
                showToast(`Successfully imported ${inserted} stores!`);
                loadAdminData();
            };
            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result;
        }

        // ============================================
        // SAMPLE DATA
        // ============================================
        function loadSampleData() {
            const sampleStores = [
                { id: 1, shop: "Rajasthan General Store", latitude: 28.6139, longitude: 77.2090, salesman: "Rahul Sharma", beat: "North Zone", created_at: new Date().toISOString() },
                { id: 2, shop: "Mahalaxmi Traders", latitude: 28.6128, longitude: 77.2294, salesman: "Amit Verma", beat: "North Zone", created_at: new Date().toISOString() },
                { id: 3, shop: "Krishna Provision Store", latitude: 28.6328, longitude: 77.2197, salesman: "Rahul Sharma", beat: "Central Zone", created_at: new Date().toISOString() },
                { id: 4, shop: "New Delhi Mart", latitude: 28.6234, longitude: 77.2103, salesman: "Priya Singh", beat: "South Zone", created_at: new Date().toISOString() },
                { id: 5, shop: "City Supermarket", latitude: 28.6412, longitude: 77.2389, salesman: "Amit Verma", beat: "East Zone", created_at: new Date().toISOString() },
                { id: 6, shop: "Goyal Kirana Store", latitude: 28.6089, longitude: 77.2345, salesman: "Priya Singh", beat: "South Zone", created_at: new Date().toISOString() },
                { id: 7, shop: "Sharma Wholesale", latitude: 28.6278, longitude: 77.2456, salesman: "Rahul Sharma", beat: "West Zone", created_at: new Date().toISOString() },
                { id: 8, shop: "Apna Bazaar", latitude: 28.6198, longitude: 77.2123, salesman: "Suresh Kumar", beat: "Central Zone", created_at: new Date().toISOString() },
                { id: 9, shop: "Punjab Provision", latitude: 28.6356, longitude: 77.2278, salesman: "Suresh Kumar", beat: "North Zone", created_at: new Date().toISOString() },
                { id: 10, shop: "Green Valley Store", latitude: 28.6067, longitude: 77.2234, salesman: "Priya Singh", beat: "South Zone", created_at: new Date().toISOString() },
                { id: 11, shop: "Bharat Traders", latitude: 28.6445, longitude: 77.2312, salesman: "Amit Verma", beat: "East Zone", created_at: new Date().toISOString() },
                { id: 12, shop: "Laxmi General Store", latitude: 28.6156, longitude: 77.2467, salesman: "Rahul Sharma", beat: "West Zone", created_at: new Date().toISOString() },
                { id: 13, shop: "Mahaveer Kirana", latitude: 28.6289, longitude: 77.2034, salesman: "Suresh Kumar", beat: "Central Zone", created_at: new Date().toISOString() },
                { id: 14, shop: "Shiv Shakti Store", latitude: 28.6034, longitude: 77.2178, salesman: "Priya Singh", beat: "South Zone", created_at: new Date().toISOString() },
                { id: 15, shop: "Ganga Traders", latitude: 28.6378, longitude: 77.2545, salesman: "Amit Verma", beat: "East Zone", created_at: new Date().toISOString() }
            ];

            const existingStores = DB.getStores();
            let inserted = 0;
            
            sampleStores.forEach(sample => {
                const isDuplicate = existingStores.some(s => 
                    s.shop.toLowerCase() === sample.shop.toLowerCase()
                );
                if (!isDuplicate) {
                    existingStores.push(sample);
                    inserted++;
                }
            });

            DB.setStores(existingStores);
            
            document.getElementById('uploadSummary').classList.remove('hidden');
            document.getElementById('totalRows').textContent = sampleStores.length;
            document.getElementById('insertedRows').textContent = inserted;
            document.getElementById('skippedRows').textContent = sampleStores.length - inserted;
            
            showToast(`Loaded ${inserted} sample stores!`);
            loadAdminData();
        }

        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        async function toggleDataVisibility() {
            const settings = await API.getSettings();
            const currentVisibility = settings.dataVisible !== false;
            const newVisibility = !currentVisibility;
            
            const result = await API.updateSettings('dataVisibility', newVisibility ? 'visible' : 'hidden');
            
            if (result.success) {
                updateDataVisibilityUI();
                showToast(t('dataVisibilityToggled') + ': ' + (newVisibility ? t('showData') : t('hideData')));
            } else {
                showToast('Failed to update visibility', 'error');
            }
        }

        async function updateDataVisibilityUI() {
            const settings = await API.getSettings();
            const isVisible = settings.dataVisible !== false;
            const statusCard = document.getElementById('visibilityStatusCard');
            const statusIcon = document.getElementById('visibilityStatusIcon');
            const statusTitle = document.getElementById('visibilityStatusTitle');
            const statusDesc = document.getElementById('visibilityStatusDesc');
            const actionButton = document.getElementById('visibilityActionButton');
            const actionIcon = document.getElementById('actionIcon');
            const headerToggle = document.getElementById('dataVisibilityToggle');
            const headerIcon = document.getElementById('visibilityIcon');
            const headerText = document.getElementById('visibilityText');

            if (isVisible) {
                // Data is VISIBLE
                statusCard.className = 'bg-white rounded-2xl card-shadow p-6 slide-up border-l-4 border-green-500';
                statusIcon.className = 'w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4';
                statusIcon.innerHTML = '<i class="fas fa-eye text-green-600 text-xl"></i>';
                statusTitle.textContent = t('dataVisible');
                statusDesc.textContent = t('dataVisibleDesc');
                actionButton.className = 'px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2 bg-red-100 text-red-600 hover:bg-red-200';
                actionIcon.className = 'fas fa-eye-slash';
                actionButton.innerHTML = '<i class="fas fa-eye-slash"></i> <span>' + t('hideData') + '</span>';
                
                if (headerToggle) {
                    headerToggle.className = 'bg-green-500/30 hover:bg-green-500/40 px-4 py-2 rounded-lg transition-all flex items-center gap-2 text-white';
                    headerIcon.className = 'fas fa-eye';
                    headerText.textContent = t('dataVisible');
                }
            } else {
                // Data is HIDDEN
                statusCard.className = 'bg-white rounded-2xl card-shadow p-6 slide-up border-l-4 border-red-500';
                statusIcon.className = 'w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4';
                statusIcon.innerHTML = '<i class="fas fa-eye-slash text-red-600 text-xl"></i>';
                statusTitle.textContent = t('dataHidden');
                statusDesc.textContent = t('dataHiddenDesc');
                actionButton.className = 'px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2 bg-green-100 text-green-600 hover:bg-green-200';
                actionIcon.className = 'fas fa-eye';
                actionButton.innerHTML = '<i class="fas fa-eye"></i> <span>' + t('showData') + '</span>';
                
                if (headerToggle) {
                    headerToggle.className = 'bg-red-500/30 hover:bg-red-500/40 px-4 py-2 rounded-lg transition-all flex items-center gap-2 text-white';
                    headerIcon.className = 'fas fa-eye-slash';
                    headerText.textContent = t('dataHidden');
                }
            }
        }

        function loadAdminData() {
            const stores = DB.getStores();
            document.getElementById('storeCount').textContent = stores.length;
            
            // Update data visibility UI
            updateDataVisibilityUI();
            
            // Update filters
            const beats = [...new Set(stores.map(s => s.beat))].filter(Boolean).sort();
            const salesmen = [...new Set(stores.map(s => s.salesman))].filter(Boolean).sort();
            
            updateFilterOptions('filterBeat', beats);
            updateFilterOptions('filterSalesman', salesmen);
            
            filterStores();
        }

        function updateFilterOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            select.innerHTML = `<option value="">All ${selectId.includes('Beat') ? 'Beats' : 'Salesmen'}</option>`;
            options.forEach(opt => {
                select.innerHTML += `<option value="${opt}">${opt}</option>`;
            });
            select.value = currentValue;
        }

        function filterStores() {
            const stores = DB.getStores();
            const beatFilter = document.getElementById('filterBeat').value;
            const salesmanFilter = document.getElementById('filterSalesman').value;
            
            filteredStores = stores.filter(store => {
                const matchBeat = !beatFilter || store.beat === beatFilter;
                const matchSalesman = !salesmanFilter || store.salesman === salesmanFilter;
                return matchBeat && matchSalesman;
            });

            currentPage = 1;
            renderStoresTable();
        }

        function renderStoresTable() {
            const tbody = document.getElementById('storesTableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageStores = filteredStores.slice(start, end);

            if (pageStores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-2"></i>
                            <p>No stores found</p>
                        </td>
                    </tr>
                `;
                document.getElementById('pagination').classList.add('hidden');
                return;
            }

            tbody.innerHTML = pageStores.map(store => `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-4 py-3">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-store text-purple-600 text-sm"></i>
                            </div>
                            <span class="font-medium text-gray-800">${escapeHtml(store.shop)}</span>
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <code class="bg-gray-100 px-2 py-1 rounded text-sm">${store.latitude.toFixed(4)}, ${store.longitude.toFixed(4)}</code>
                    </td>
                    <td class="px-4 py-3 text-gray-600">${escapeHtml(store.salesman)}</td>
                    <td class="px-4 py-3">
                        <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs">${escapeHtml(store.beat)}</span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button onclick="openStoreModal(${store.id})" class="text-blue-600 hover:text-blue-800 p-1" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="deleteStore(${store.id})" class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            <a href="https://www.google.com/maps?q=${store.latitude},${store.longitude}" target="_blank" class="text-green-600 hover:text-green-800 p-1" title="Navigate">
                                <i class="fas fa-directions"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Update pagination
            const totalPages = Math.ceil(filteredStores.length / itemsPerPage);
            if (totalPages > 1) {
                document.getElementById('pagination').classList.remove('hidden');
                document.getElementById('showingCount').textContent = filteredStores.length;
                document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            } else {
                document.getElementById('pagination').classList.add('hidden');
            }
        }

        function changePage(delta) {
            const totalPages = Math.ceil(filteredStores.length / itemsPerPage);
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderStoresTable();
            }
        }

        function deleteStore(id) {
            if (confirm('Are you sure you want to delete this store?')) {
                const stores = DB.getStores().filter(s => s.id !== id);
                DB.setStores(stores);
                showToast('Store deleted successfully');
                loadAdminData();
            }
        }

        function clearAllStores() {
            if (confirm('Are you sure you want to delete ALL stores? This cannot be undone.')) {
                DB.setStores([]);
                showToast('All stores cleared');
                loadAdminData();
            }
        }

        // ============================================
        // DELIVERY FUNCTIONS
        // ============================================
        function checkDataVisibility() {
            const isVisible = DB.getDataVisibility();
            if (!isVisible) {
                const grid = document.getElementById('storesGrid');
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-lock text-red-500 text-4xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2" data-i18n="dataHidden">${t('dataHidden')}</h3>
                        <p class="text-gray-500">${t('dataHiddenDesc')}</p>
                        <p class="text-gray-400 text-sm mt-4"><i class="fas fa-info-circle mr-1"></i> Please contact admin</p>
                    </div>
                `;
                return false;
            }
            return true;
        }

        function loadDeliveryData() {
            const stores = DB.getStores();
            
            // Update filters
            const beats = [...new Set(stores.map(s => s.beat))].filter(Boolean).sort();
            const salesmen = [...new Set(stores.map(s => s.salesman))].filter(Boolean).sort();
            
            updateFilterOptions('deliveryFilterBeat', beats);
            updateFilterOptions('deliveryFilterSalesman', salesmen);
            
            renderStoresGrid(stores);
        }

        function filterDeliveryStores() {
            const stores = DB.getStores();
            const beatFilter = document.getElementById('deliveryFilterBeat').value;
            const salesmanFilter = document.getElementById('deliveryFilterSalesman').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = stores.filter(store => {
                const matchBeat = !beatFilter || store.beat === beatFilter;
                const matchSalesman = !salesmanFilter || store.salesman === salesmanFilter;
                const matchSearch = !searchQuery || store.shop.toLowerCase().includes(searchQuery);
                return matchBeat && matchSalesman && matchSearch;
            });

            renderStoresGrid(filtered);
        }

        function renderStoresGrid(stores) {
            const grid = document.getElementById('storesGrid');
            
            if (stores.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-store text-4xl mb-2"></i>
                        <p>No stores available</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = stores.map(store => `
                <div class="store-card bg-white border border-gray-200 rounded-xl p-4 cursor-pointer transition-all" onclick="openStoreModal(${store.id})">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-store text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 line-clamp-1">${escapeHtml(store.shop)}</h4>
                                <p class="text-xs text-gray-500">${escapeHtml(store.beat)}</p>
                            </div>
                        </div>
                        <button onclick="event.stopPropagation(); openMap(${store.latitude}, ${store.longitude})" 
                            class="w-10 h-10 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-all">
                            <i class="fas fa-directions"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-500">
                            <i class="fas fa-user mr-1"></i>${escapeHtml(store.salesman)}
                        </span>
                        <code class="bg-gray-100 px-2 py-1 rounded text-xs">${store.latitude.toFixed(3)}, ${store.longitude.toFixed(3)}</code>
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // SEARCH & AUTOCOMPLETE
        // ============================================
        let searchTimeout;

        function handleSearch(event) {
            clearTimeout(searchTimeout);
            const query = event.target.value.trim();
            
            if (query.length < 2) {
                document.getElementById('autocompleteDropdown').classList.add('hidden');
                document.getElementById('searchResultsSection').classList.add('hidden');
                showRecentSearches();
                return;
            }

            document.getElementById('recentSearches').classList.add('hidden');
            
            searchTimeout = setTimeout(() => {
                showAutocomplete(query);
            }, 300);
        }

        function showAutocomplete(query) {
            const stores = DB.getStores();
            const beatFilter = document.getElementById('deliveryFilterBeat').value;
            const salesmanFilter = document.getElementById('deliveryFilterSalesman').value;
            
            const matches = stores.filter(store => {
                const matchQuery = store.shop.toLowerCase().includes(query.toLowerCase());
                const matchBeat = !beatFilter || store.beat === beatFilter;
                const matchSalesman = !salesmanFilter || store.salesman === salesmanFilter;
                return matchQuery && matchBeat && matchSalesman;
            }).slice(0, 10);

            const dropdown = document.getElementById('autocompleteDropdown');
            
            if (matches.length === 0) {
                dropdown.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <i class="fas fa-search text-2xl mb-2"></i>
                        <p>No stores found</p>
                    </div>
                `;
            } else {
                dropdown.innerHTML = matches.map(store => `
                    <div class="autocomplete-item px-4 py-3 cursor-pointer border-b border-gray-100 last:border-0" 
                         onclick="selectStore(${store.id}, '${escapeHtml(store.shop)}')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-store text-green-600 text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-800">${escapeHtml(store.shop)}</p>
                                <p class="text-xs text-gray-500">${escapeHtml(store.beat)} ‚Ä¢ ${escapeHtml(store.salesman)}</p>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                `).join('');
            }
            
            dropdown.classList.remove('hidden');
        }

        function selectStore(id, name) {
            document.getElementById('searchInput').value = name;
            document.getElementById('autocompleteDropdown').classList.add('hidden');
            DB.addRecentSearch(name);
            openStoreModal(id);
            performSearch(name);
        }

        function performSearch(query = null) {
            const searchQuery = query || document.getElementById('searchInput').value.trim();
            if (!searchQuery) return;

            document.getElementById('autocompleteDropdown').classList.add('hidden');
            
            const stores = DB.getStores();
            const beatFilter = document.getElementById('deliveryFilterBeat').value;
            const salesmanFilter = document.getElementById('deliveryFilterSalesman').value;
            
            const matches = stores.filter(store => {
                const matchQuery = store.shop.toLowerCase().includes(searchQuery.toLowerCase());
                const matchBeat = !beatFilter || store.beat === beatFilter;
                const matchSalesman = !salesmanFilter || store.salesman === salesmanFilter;
                return matchQuery && matchBeat && matchSalesman;
            });

            DB.addRecentSearch(searchQuery);

            const resultsSection = document.getElementById('searchResultsSection');
            const resultsDiv = document.getElementById('searchResults');
            
            if (matches.length === 0) {
                resultsSection.classList.remove('hidden');
                document.getElementById('resultCount').textContent = '(0 found)';
                resultsDiv.innerHTML = `
                    <div class="text-center py-8 text-gray-500 bg-white rounded-xl">
                        <i class="fas fa-search text-4xl mb-2"></i>
                        <p>No stores found for "${escapeHtml(searchQuery)}"</p>
                    </div>
                `;
            } else {
                resultsSection.classList.remove('hidden');
                document.getElementById('resultCount').textContent = `(${matches.length} found)`;
                resultsDiv.innerHTML = matches.map(store => `
                    <div class="bg-white rounded-xl p-4 border border-gray-200 hover:border-green-500 cursor-pointer transition-all" 
                         onclick="openStoreModal(${store.id})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-store text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">${escapeHtml(store.shop)}</h4>
                                    <p class="text-sm text-gray-500">${escapeHtml(store.beat)} ‚Ä¢ ${escapeHtml(store.salesman)}</p>
                                </div>
                            </div>
                            <button onclick="event.stopPropagation(); openMap(${store.latitude}, ${store.longitude})" 
                                class="w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full flex items-center justify-center text-white transition-all">
                                <i class="fas fa-directions"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function showRecentSearches() {
            const searches = DB.getRecentSearches();
            const recentDiv = document.getElementById('recentSearches');
            const tagsDiv = document.getElementById('recentSearchTags');
            
            if (searches.length === 0) {
                recentDiv.classList.add('hidden');
                return;
            }

            recentDiv.classList.remove('hidden');
            tagsDiv.innerHTML = searches.map(search => `
                <button onclick="selectSearch('${escapeHtml(search)}')" 
                    class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm text-gray-700 transition-all">
                    ${escapeHtml(search)}
                </button>
            `).join('');
        }

        function selectSearch(search) {
            document.getElementById('searchInput').value = search;
            document.getElementById('recentSearches').classList.add('hidden');
            performSearch(search);
        }

        // Hide autocomplete on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#searchInput') && !e.target.closest('#autocompleteDropdown')) {
                document.getElementById('autocompleteDropdown').classList.add('hidden');
            }
        });

        // ============================================
        // MAP NAVIGATION
        // ============================================
        function openMap(lat, lng) {
            const url = `https://www.google.com/maps?q=${lat},${lng}`;
            window.open(url, '_blank');
            showToast('Opening Google Maps...');
        }

        // ============================================
        // STORE MODAL
        // ============================================
        function openStoreModal(id) {
            const stores = DB.getStores();
            const store = stores.find(s => s.id === id);
            
            if (!store) return;

            document.getElementById('modalStoreName').textContent = store.shop;
            document.getElementById('modalStoreId').textContent = `ID: ${store.id}`;
            document.getElementById('modalCoords').textContent = `${store.latitude.toFixed(6)}, ${store.longitude.toFixed(6)}`;
            document.getElementById('modalSalesman').textContent = store.salesman;
            document.getElementById('modalBeat').textContent = store.beat;
            
            const mapUrl = `https://www.google.com/maps?q=${store.latitude},${store.longitude}`;
            document.getElementById('mapLink').href = mapUrl;
            document.getElementById('mapBtn').href = mapUrl;
            
            document.getElementById('storeModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('storeModal').classList.add('hidden');
        }

        // Close modal on outside click
        document.getElementById('storeModal').addEventListener('click', (e) => {
            if (e.target.id === 'storeModal') {
                closeModal();
            }
        });

        // ============================================
        // UTILITIES
        // ============================================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg z-50 slide-up ${
                type === 'error' ? 'bg-red-500' : 'bg-gray-800'
            } text-white`;
            
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Handle route
            const isAdminRoute = handleRoute();
            
            // Check if user is logged in
            const user = DB.getUser();
            if (user) {
                if (user.role === 'admin') {
                    showAdminDashboard();
                } else {
                    showDeliveryDashboard();
                }
            }

            // Enter key for search
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // Enter key for login
            document.getElementById('password')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitLogin();
                }
            });
            
            // Handle hash changes for routing
            window.addEventListener('hashchange', () => {
                const user = DB.getUser();
                if (!user) {
                    handleRoute();
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                document.getElementById('autocompleteDropdown').classList.add('hidden');
            }
        });
    </script>
</body>
</html>